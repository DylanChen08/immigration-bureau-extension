# ç§»æ°‘å±€æ‰©å±• - æ ¸å¿ƒåŠŸèƒ½ä¸æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª Chrome æµè§ˆå™¨æ‰©å±•ï¼Œç”¨äºåœ¨ç§»æ°‘å±€ç½‘ç«™è¡¨å•é¡µé¢æ˜¾ç¤ºå…¨å±é®ç½©æç¤ºã€‚å½“ç”¨æˆ·è¿›å…¥å…¥å¢ƒå¡å¡«æŠ¥è¡¨å•çš„ç¬¬ä¸€æ­¥ï¼ˆè¯ä»¶èµ„æ–™é¡µä¸Šä¼ ï¼‰æ—¶ï¼Œè‡ªåŠ¨æ˜¾ç¤º"è¯·åˆ·è¯ä»¶"çš„æç¤ºç•Œé¢ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ™ºèƒ½é¡µé¢æ£€æµ‹
- **URL æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹ç›®æ ‡é¡µé¢ URL (`entry-registation-form`)
- **æ­¥éª¤çŠ¶æ€æ£€æµ‹**: æ£€æµ‹ Element UI Steps ç»„ä»¶çš„ç¬¬ä¸€æ­¥æ˜¯å¦æ¿€æ´»
- **å®æ—¶ç›‘å¬**: ä½¿ç”¨ MutationObserver ç›‘å¬ DOM å˜åŒ–ï¼Œå®æ—¶å“åº”æ­¥éª¤åˆ‡æ¢

### 2. å…¨å±é®ç½©å±‚æ˜¾ç¤º
- **è‡ªåŠ¨æ˜¾ç¤º**: å½“ç¬¬ä¸€æ­¥æ¿€æ´»æ—¶è‡ªåŠ¨æ˜¾ç¤ºé®ç½©
- **è§†è§‰æ•ˆæœ**: åŠé€æ˜é»‘è‰²èƒŒæ™¯ï¼Œå±…ä¸­æ˜¾ç¤ºæç¤ºæ–‡å­—å’ŒåŠ¨ç”» GIF
- **è‡ªåŠ¨éšè—**: å½“ç¦»å¼€ç¬¬ä¸€æ­¥æ—¶è‡ªåŠ¨éšè—é®ç½©

### 3. åŠ¨ç”»æ•ˆæœ
- **æ–‡å­—åŠ¨ç”»**: "è¯·åˆ·è¯ä»¶"æ–‡å­—å¸¦æœ‰è„‰å†²åŠ¨ç”»æ•ˆæœ
- **GIF åŠ¨ç”»**: æ”¯æŒæ˜¾ç¤ºè¯ä»¶æ‰«æç›¸å…³çš„ GIF åŠ¨ç”»
- **è¿‡æ¸¡æ•ˆæœ**: æ·¡å…¥æ·¡å‡ºã€ç¼©æ”¾ç­‰å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ–‡ä»¶ç»“æ„

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ manifest.json       # æ‰©å±•é…ç½®æ–‡ä»¶ (Manifest V3)
â”‚   â”œâ”€â”€ content.ts          # å†…å®¹è„šæœ¬ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ content.css         # é®ç½©å±‚æ ·å¼
â”‚   â”œâ”€â”€ background.ts       # åå°æœåŠ¡è„šæœ¬
â”‚   â”œâ”€â”€ assets/             # èµ„æºæ–‡ä»¶ç›®å½•
â”‚   â”‚   â””â”€â”€ id-card-scan.gif # GIF åŠ¨ç”»æ–‡ä»¶
â”‚   â””â”€â”€ icons/              # æ‰©å±•å›¾æ ‡
```

### æ ¸å¿ƒç»„ä»¶

#### 1. Content Script (`content.ts`)
ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘å®ç°ï¼ŒåŒ…å«ï¼š
- é¡µé¢æ£€æµ‹é€»è¾‘
- é®ç½©å±‚åˆ›å»ºä¸ç®¡ç†
- DOM ç›‘å¬æœºåˆ¶
- æ¶ˆæ¯é€šä¿¡å¤„ç†

#### 2. æ ·å¼æ–‡ä»¶ (`content.css`)
é®ç½©å±‚çš„å®Œæ•´æ ·å¼å®šä¹‰ï¼ŒåŒ…æ‹¬ï¼š
- å…¨å±å®šä½
- å±…ä¸­å¸ƒå±€
- åŠ¨ç”»æ•ˆæœ
- å“åº”å¼è®¾è®¡

#### 3. Manifest é…ç½® (`manifest.json`)
Manifest V3 é…ç½®ï¼Œå®šä¹‰ï¼š
- æ‰©å±•æƒé™
- å†…å®¹è„šæœ¬æ³¨å…¥è§„åˆ™
- èµ„æºè®¿é—®é…ç½®

## ğŸ“ æ ¸å¿ƒé€»è¾‘è¯¦è§£

### 1. é¡µé¢æ£€æµ‹é€»è¾‘

```typescript
function checkAndShowOverlay() {
  const currentUrl = window.location.href;
  
  // 1. URL æ£€æµ‹
  if (!currentUrl.includes("entry-registation-form")) {
    return;
  }

  // 2. ç­‰å¾…é¡µé¢åŠ è½½
  if (document.readyState !== "complete") {
    window.addEventListener("load", checkAndShowOverlay);
    return;
  }

  // 3. ç­‰å¾… Vue ç»„ä»¶æ¸²æŸ“ï¼ˆå»¶è¿Ÿæ£€æµ‹ï¼‰
  setTimeout(() => {
    // 4. æŸ¥æ‰¾æ­¥éª¤å…ƒç´ 
    const steps = document.querySelectorAll(".el-step");
    if (steps.length === 0) {
      setTimeout(checkAndShowOverlay, 500);
      return;
    }

    // 5. æ£€æµ‹ç¬¬ä¸€æ­¥çŠ¶æ€
    const firstStep = steps[0];
    const isFirstStepActive = 
      firstStep?.querySelector(".is-process") !== null ||
      firstStep?.querySelector(".el-step__head.is-process") !== null ||
      firstStep?.classList.contains("is-process");

    // 6. æ˜¾ç¤ºæˆ–éšè—é®ç½©
    if (isFirstStepActive) {
      showOverlay();
    } else {
      hideOverlay();
    }
  }, 1000);
}
```

**å…³é”®ç‚¹ï¼š**
- **å»¶è¿Ÿæ£€æµ‹**: ä½¿ç”¨ `setTimeout` ç­‰å¾… Vue/Element UI ç»„ä»¶æ¸²æŸ“
- **å¤šé‡æ£€æµ‹**: é€šè¿‡å¤šç§é€‰æ‹©å™¨ç»„åˆç¡®ä¿å‡†ç¡®æ£€æµ‹ç¬¬ä¸€æ­¥çŠ¶æ€
- **é‡è¯•æœºåˆ¶**: å¦‚æœå…ƒç´ æœªæ‰¾åˆ°ï¼Œè‡ªåŠ¨é‡è¯•æ£€æµ‹

### 2. DOM ç›‘å¬æœºåˆ¶

```typescript
function observeStepChanges() {
  const stepsContainer = document.querySelector(".el-steps");
  if (!stepsContainer) {
    setTimeout(observeStepChanges, 500);
    return;
  }

  // åˆ›å»º MutationObserver ç›‘å¬ DOM å˜åŒ–
  const observer = new MutationObserver(() => {
    checkAndShowOverlay();
  });

  // ç›‘å¬é…ç½®
  observer.observe(stepsContainer, {
    childList: true,      // ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–
    subtree: true,        // ç›‘å¬æ‰€æœ‰åä»£èŠ‚ç‚¹
    attributes: true,     // ç›‘å¬å±æ€§å˜åŒ–
    attributeFilter: ["class"],  // åªç›‘å¬ class å±æ€§
  });

  checkAndShowOverlay();  // åˆå§‹æ£€æŸ¥
}
```

**ç›‘å¬ç­–ç•¥ï¼š**
- **å®æ—¶å“åº”**: MutationObserver å®æ—¶ç›‘å¬æ­¥éª¤çŠ¶æ€å˜åŒ–
- **èŒƒå›´ç›‘å¬**: ç›‘å¬æ•´ä¸ª `.el-steps` å®¹å™¨åŠå…¶å­æ ‘
- **ç±»åç›‘å¬**: é‡ç‚¹ç›‘å¬ `class` å±æ€§å˜åŒ–ï¼ˆ`is-process` ç­‰çŠ¶æ€ç±»ï¼‰

### 3. é®ç½©å±‚åˆ›å»º

```typescript
function showOverlay() {
  // é˜²æ­¢é‡å¤åˆ›å»º
  if (document.getElementById(OVERLAY_ID)) {
    return;
  }

  const overlay = document.createElement("div");
  overlay.id = OVERLAY_ID;
  overlay.innerHTML = `
    <div class="overlay-content">
      <div class="overlay-text">è¯·åˆ·è¯ä»¶</div>
      <div class="overlay-gif-container">
        <img 
          src="${chrome.runtime.getURL("assets/id-card-scan.gif")}" 
          alt="è¯·åˆ·è¯ä»¶åŠ¨ç”»"
          class="overlay-gif"
          onerror="å¤„ç†GIFåŠ è½½å¤±è´¥"
        />
      </div>
    </div>
  `;

  document.body.appendChild(overlay);
}
```

**æŠ€æœ¯è¦ç‚¹ï¼š**
- **åŠ¨æ€åˆ›å»º**: ä½¿ç”¨ `document.createElement` åŠ¨æ€åˆ›å»ºé®ç½©å…ƒç´ 
- **èµ„æºè·¯å¾„**: ä½¿ç”¨ `chrome.runtime.getURL()` è·å–æ‰©å±•èµ„æºè·¯å¾„
- **é”™è¯¯å¤„ç†**: é€šè¿‡ `onerror` å¤„ç† GIF åŠ è½½å¤±è´¥æƒ…å†µ
- **é˜²é‡å¤**: é€šè¿‡ ID æ£€æŸ¥é¿å…é‡å¤åˆ›å»º

### 4. URL å˜åŒ–ç›‘å¬

```typescript
// ç›‘å¬ URL å˜åŒ–ï¼ˆé€‚ç”¨äº Vue Router å•é¡µåº”ç”¨ï¼‰
let lastUrl = window.location.href;
setInterval(() => {
  const currentUrl = window.location.href;
  if (currentUrl !== lastUrl) {
    lastUrl = currentUrl;
    checkAndShowOverlay();
  }
}, 1000);
```

**é€‚ç”¨åœºæ™¯ï¼š**
- å•é¡µåº”ç”¨ï¼ˆSPAï¼‰è·¯ç”±å˜åŒ–
- é¡µé¢åŠ¨æ€åŠ è½½
- ç”¨æˆ·å‰è¿›/åé€€å¯¼èˆª

### 5. æ¶ˆæ¯é€šä¿¡

```typescript
chrome.runtime.onMessage.addListener((message, _sender, sendResponse) => {
  if (message.type === "GET_PAGE_INFO") {
    const pageInfo = {
      title: document.title,
      url: window.location.href,
      timestamp: new Date().toISOString(),
      hasFirstStep: document.querySelector(".el-step .is-process") !== null,
    };
    sendResponse(pageInfo);
  } else if (message.type === "TOGGLE_OVERLAY") {
    if (message.show) {
      showOverlay();
    } else {
      hideOverlay();
    }
    sendResponse({ success: true });
  }
  return true;  // ä¿æŒæ¶ˆæ¯é€šé“å¼€æ”¾
});
```

## ğŸ¨ æ ·å¼è®¾è®¡

### é®ç½©å±‚æ ·å¼è¦ç‚¹

```css
#immigration-bureau-overlay {
  position: fixed;           /* å›ºå®šå®šä½ */
  top: 0; left: 0;          /* è¦†ç›–æ•´ä¸ªå±å¹• */
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.85);  /* åŠé€æ˜é»‘è‰²èƒŒæ™¯ */
  z-index: 999999;           /* æœ€é«˜å±‚çº§ */
  display: flex;              /* Flexbox å±…ä¸­ */
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s;     /* æ·¡å…¥åŠ¨ç”» */
}
```

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- **å…¨å±è¦†ç›–**: `position: fixed` ç¡®ä¿è¦†ç›–æ•´ä¸ªè§†å£
- **é«˜å±‚çº§**: `z-index: 999999` ç¡®ä¿åœ¨æœ€ä¸Šå±‚
- **å±…ä¸­å¸ƒå±€**: Flexbox å®ç°å®Œç¾å±…ä¸­
- **åŠ¨ç”»æ•ˆæœ**: æ·¡å…¥ã€è„‰å†²ã€ç¼©æ”¾ç­‰å¤šç§åŠ¨ç”»

### åŠ¨ç”»æ•ˆæœ

```css
/* æ–‡å­—è„‰å†²åŠ¨ç”» */
@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.05); opacity: 0.9; }
}

/* GIF å®¹å™¨ç¼©æ”¾åŠ¨ç”» */
@keyframes scaleIn {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
```

## âš™ï¸ Manifest é…ç½®

### å…³é”®é…ç½®é¡¹

```json
{
  "manifest_version": 3,
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["content.js"],
      "css": ["content.css"]
    }
  ],
  "web_accessible_resources": [
    {
      "resources": ["assets/*"],
      "matches": ["<all_urls>"]
    }
  ]
}
```

**é…ç½®è¯´æ˜ï¼š**
- **matches**: `["<all_urls>"]` åœ¨æ‰€æœ‰é¡µé¢æ³¨å…¥è„šæœ¬
- **web_accessible_resources**: å…è®¸é¡µé¢è®¿é—®æ‰©å±•èµ„æºï¼ˆGIF æ–‡ä»¶ï¼‰
- **css**: è‡ªåŠ¨æ³¨å…¥æ ·å¼æ–‡ä»¶

## ğŸ”§ åœ¨å…¶ä»–é¡¹ç›®ä¸­ä½¿ç”¨

### 1. å¤åˆ¶æ ¸å¿ƒæ–‡ä»¶

éœ€è¦å¤åˆ¶çš„æ–‡ä»¶ï¼š
- `src/content.ts` â†’ å†…å®¹è„šæœ¬é€»è¾‘
- `src/content.css` â†’ æ ·å¼æ–‡ä»¶
- ç›¸å…³èµ„æºæ–‡ä»¶ï¼ˆGIFã€å›¾æ ‡ç­‰ï¼‰

### 2. ä¿®æ”¹é…ç½®

#### ä¿®æ”¹ç›®æ ‡ URL æ£€æµ‹

```typescript
// åœ¨ content.ts ä¸­ä¿®æ”¹
if (!currentUrl.includes("your-target-url")) {
  return;
}
```

#### ä¿®æ”¹æ­¥éª¤æ£€æµ‹é€‰æ‹©å™¨

```typescript
// æ ¹æ®ç›®æ ‡ç½‘ç«™è°ƒæ•´é€‰æ‹©å™¨
const steps = document.querySelectorAll(".your-step-selector");
const isFirstStepActive = 
  firstStep?.querySelector(".your-active-class") !== null;
```

#### ä¿®æ”¹é®ç½©æ–‡å­—å’Œ GIF

```typescript
overlay.innerHTML = `
  <div class="overlay-content">
    <div class="overlay-text">ä½ çš„æç¤ºæ–‡å­—</div>
    <div class="overlay-gif-container">
      <img src="${chrome.runtime.getURL("assets/your-gif.gif")}" />
    </div>
  </div>
`;
```

### 3. é›†æˆæ­¥éª¤

1. **æ·»åŠ  Manifest é…ç½®**
   ```json
   {
     "content_scripts": [
       {
         "matches": ["ä½ çš„ç›®æ ‡ç½‘ç«™URL"],
         "js": ["content.js"],
         "css": ["content.css"]
       }
     ]
   }
   ```

2. **é…ç½®èµ„æºè®¿é—®**
   ```json
   {
     "web_accessible_resources": [
       {
         "resources": ["assets/*"],
         "matches": ["ä½ çš„ç›®æ ‡ç½‘ç«™URL"]
       }
     ]
   }
   ```

3. **å‡†å¤‡èµ„æºæ–‡ä»¶**
   - å°† GIF æ–‡ä»¶æ”¾ç½®åœ¨ `assets/` ç›®å½•
   - æ›´æ–°ä»£ç ä¸­çš„ GIF è·¯å¾„

## ğŸ“Š å·¥ä½œæµç¨‹å›¾

```
é¡µé¢åŠ è½½
  â†“
å†…å®¹è„šæœ¬æ³¨å…¥
  â†“
æ£€æµ‹ URL æ˜¯å¦åŒ¹é…
  â†“ æ˜¯
ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
  â†“
ç­‰å¾… Vue ç»„ä»¶æ¸²æŸ“ï¼ˆå»¶è¿Ÿ 1 ç§’ï¼‰
  â†“
æŸ¥æ‰¾æ­¥éª¤å…ƒç´ 
  â†“ æ‰¾åˆ°
æ£€æµ‹ç¬¬ä¸€æ­¥çŠ¶æ€
  â†“
ç¬¬ä¸€æ­¥æ¿€æ´»ï¼Ÿ
  â†“ æ˜¯                     â†“ å¦
æ˜¾ç¤ºé®ç½©å±‚               éšè—é®ç½©å±‚
  â†“
MutationObserver ç›‘å¬å˜åŒ–
  â†“
æ­¥éª¤çŠ¶æ€æ”¹å˜ â†’ é‡æ–°æ£€æµ‹ â†’ æ›´æ–°é®ç½©æ˜¾ç¤ºçŠ¶æ€
```

## ğŸ¯ å…³é”®æ£€æµ‹é€»è¾‘æ€»ç»“

### ç¬¬ä¸€æ­¥æ£€æµ‹çš„ä¸‰ç§æ–¹å¼

1. **å­å…ƒç´ æ£€æµ‹**: `firstStep?.querySelector(".is-process") !== null`
2. **å¤´éƒ¨æ£€æµ‹**: `firstStep?.querySelector(".el-step__head.is-process") !== null`
3. **ç›´æ¥ç±»åæ£€æµ‹**: `firstStep?.classList.contains("is-process")`

### å¤šé‡ä¿éšœæœºåˆ¶

1. **å»¶è¿Ÿæ£€æµ‹**: ç­‰å¾… Vue ç»„ä»¶æ¸²æŸ“ï¼ˆ1ç§’å»¶è¿Ÿï¼‰
2. **é‡è¯•æœºåˆ¶**: å…ƒç´ æœªæ‰¾åˆ°æ—¶è‡ªåŠ¨é‡è¯•ï¼ˆ500ms é—´éš”ï¼‰
3. **DOM ç›‘å¬**: MutationObserver å®æ—¶ç›‘å¬å˜åŒ–
4. **URL ç›‘å¬**: å®šæ—¶æ£€æŸ¥ URL å˜åŒ–ï¼ˆ1ç§’é—´éš”ï¼‰

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### æ€§èƒ½ä¼˜åŒ–

1. **é˜²æŠ–å¤„ç†**: å¯¹é¢‘ç¹è§¦å‘çš„æ£€æµ‹å‡½æ•°æ·»åŠ é˜²æŠ–
2. **èŠ‚æµå¤„ç†**: URL æ£€æŸ¥å¯ä»¥ä½¿ç”¨èŠ‚æµè€Œéå®šæ—¶å™¨
3. **é€‰æ‹©å™¨ç¼“å­˜**: ç¼“å­˜å¸¸ç”¨çš„ DOM æŸ¥è¯¢ç»“æœ

### ç”¨æˆ·ä½“éªŒ

1. **åŠ è½½çŠ¶æ€**: æ˜¾ç¤º GIF åŠ è½½çŠ¶æ€
2. **å…³é—­æŒ‰é’®**: å…è®¸ç”¨æˆ·æ‰‹åŠ¨å…³é—­é®ç½©
3. **é”®ç›˜æ”¯æŒ**: ESC é”®å…³é—­é®ç½©
4. **å“åº”å¼ä¼˜åŒ–**: ç§»åŠ¨ç«¯é€‚é…

### é”™è¯¯å¤„ç†

1. **èµ„æºåŠ è½½å¤±è´¥**: æä¾›å ä½å›¾æˆ–æ–‡å­—æç¤º
2. **ç½‘ç»œå¼‚å¸¸**: å¤„ç† GIF åŠ è½½è¶…æ—¶
3. **DOM å¼‚å¸¸**: å¤„ç†å…ƒç´ ä¸å­˜åœ¨çš„æƒ…å†µ

## ğŸ” è°ƒè¯•æŠ€å·§

### Console æ—¥å¿—

ä»£ç ä¸­å·²åŒ…å«å…³é”®æ—¥å¿—ï¼š
```typescript
console.log("å†…å®¹è„šæœ¬å·²åŠ è½½ - ç§»æ°‘å±€æ‰©å±•");
console.log("é®ç½©å±‚å·²æ˜¾ç¤º");
console.log("é®ç½©å±‚å·²éšè—");
```

### Chrome DevTools

1. **æ£€æŸ¥é®ç½©å…ƒç´ **: `document.getElementById("immigration-bureau-overlay")`
2. **æ£€æŸ¥æ­¥éª¤çŠ¶æ€**: `document.querySelectorAll(".el-step")`
3. **æŸ¥çœ‹æ¶ˆæ¯é€šä¿¡**: Chrome Extensions â†’ Background page â†’ Console

### æµ‹è¯•æ­¥éª¤

1. æ‰“å¼€ç›®æ ‡é¡µé¢
2. ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
3. æ£€æŸ¥ Console æ˜¯å¦æœ‰æ—¥å¿—è¾“å‡º
4. æ£€æŸ¥é®ç½©å…ƒç´ æ˜¯å¦åˆ›å»º
5. æ£€æŸ¥ GIF èµ„æºæ˜¯å¦åŠ è½½

## ğŸ“š å‚è€ƒèµ„æ–™

- [Chrome Extensions Manifest V3](https://developer.chrome.com/docs/extensions/mv3/)
- [Content Scripts API](https://developer.chrome.com/docs/extensions/mv3/content_scripts/)
- [MutationObserver API](https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver)
- [Element UI Steps æ–‡æ¡£](https://element.eleme.cn/#/zh-CN/component/steps)

## ğŸ“„ å®Œæ•´ä»£ç æ¸…å•

### content.ts å®Œæ•´ä»£ç 

```typescript
// Content Script - åœ¨ç½‘é¡µä¸Šä¸‹æ–‡ä¸­è¿è¡Œ
import "./content.css";

console.log("å†…å®¹è„šæœ¬å·²åŠ è½½ - ç§»æ°‘å±€æ‰©å±•");

// é®ç½©å±‚ ID
const OVERLAY_ID = "immigration-bureau-overlay";

// æ£€æŸ¥æ˜¯å¦æ˜¯ç›®æ ‡é¡µé¢å’Œç¬¬ä¸€æ­¥
function checkAndShowOverlay() {
  const currentUrl = window.location.href;
  
  // æ£€æŸ¥ URL
  if (!currentUrl.includes("entry-registation-form")) {
    return;
  }

  // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
  if (document.readyState !== "complete") {
    window.addEventListener("load", checkAndShowOverlay);
    return;
  }

  // ç­‰å¾… Vue ç»„ä»¶æ¸²æŸ“ï¼ˆElement UIï¼‰
  setTimeout(() => {
    // æŸ¥æ‰¾ç¬¬ä¸€æ­¥ï¼ˆel-stepï¼‰
    const steps = document.querySelectorAll(".el-step");
    if (steps.length === 0) {
      // å¦‚æœè¿˜æ²¡æ¸²æŸ“ï¼Œå†æ¬¡å°è¯•
      setTimeout(checkAndShowOverlay, 500);
      return;
    }

    const firstStep = steps[0];
    const isFirstStepActive = 
      firstStep?.querySelector(".is-process") !== null ||
      firstStep?.querySelector(".el-step__head.is-process") !== null ||
      firstStep?.classList.contains("is-process");

    if (isFirstStepActive) {
      showOverlay();
    } else {
      hideOverlay();
    }
  }, 1000);
}

// æ˜¾ç¤ºé®ç½©å±‚
function showOverlay() {
  // å¦‚æœå·²ç»å­˜åœ¨ï¼Œä¸é‡å¤åˆ›å»º
  if (document.getElementById(OVERLAY_ID)) {
    return;
  }

  const overlay = document.createElement("div");
  overlay.id = OVERLAY_ID;
  overlay.innerHTML = `
    <div class="overlay-content">
      <div class="overlay-text">è¯·åˆ·è¯ä»¶</div>
      <div class="overlay-gif-container">
        <img 
          src="${chrome.runtime.getURL("assets/id-card-scan.gif")}" 
          alt="è¯·åˆ·è¯ä»¶åŠ¨ç”»"
          class="overlay-gif"
          onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\\'color: white; font-size: 16px;\\'>GIF æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œè¯·å°† id-card-scan.gif æ”¾ç½®åœ¨ src/assets/ ç›®å½•ä¸‹</div>'"
        />
      </div>
    </div>
  `;

  document.body.appendChild(overlay);
  console.log("é®ç½©å±‚å·²æ˜¾ç¤º");
}

// éšè—é®ç½©å±‚
function hideOverlay() {
  const overlay = document.getElementById(OVERLAY_ID);
  if (overlay) {
    overlay.remove();
    console.log("é®ç½©å±‚å·²éšè—");
  }
}

// ä½¿ç”¨ MutationObserver ç›‘å¬æ­¥éª¤å˜åŒ–
function observeStepChanges() {
  const stepsContainer = document.querySelector(".el-steps");
  if (!stepsContainer) {
    setTimeout(observeStepChanges, 500);
    return;
  }

  const observer = new MutationObserver(() => {
    checkAndShowOverlay();
  });

  observer.observe(stepsContainer, {
    childList: true,
    subtree: true,
    attributes: true,
    attributeFilter: ["class"],
  });

  // åˆå§‹æ£€æŸ¥
  checkAndShowOverlay();
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", () => {
    observeStepChanges();
  });
} else {
  observeStepChanges();
}

// ç›‘å¬ URL å˜åŒ–ï¼ˆVue Router å¯èƒ½æ”¹å˜ URLï¼‰
let lastUrl = window.location.href;
setInterval(() => {
  const currentUrl = window.location.href;
  if (currentUrl !== lastUrl) {
    lastUrl = currentUrl;
    checkAndShowOverlay();
  }
}, 1000);

// ç›‘å¬æ¥è‡ª background æˆ– popup çš„æ¶ˆæ¯
chrome.runtime.onMessage.addListener((message, _sender, sendResponse) => {
  if (message.type === "GET_PAGE_INFO") {
    const pageInfo = {
      title: document.title,
      url: window.location.href,
      timestamp: new Date().toISOString(),
      hasFirstStep: document.querySelector(".el-step .is-process") !== null,
    };
    sendResponse(pageInfo);
  } else if (message.type === "TOGGLE_OVERLAY") {
    if (message.show) {
      showOverlay();
    } else {
      hideOverlay();
    }
    sendResponse({ success: true });
  }
  return true;
});
```

### content.css å®Œæ•´ä»£ç 

```css
/* é®ç½©å±‚æ ·å¼ */
#immigration-bureau-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  z-index: 999999;
  display: flex;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.overlay-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 30px;
  text-align: center;
}

.overlay-text {
  font-size: 48px;
  font-weight: bold;
  color: #ffffff;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  font-family: -apple-system, BlinkMacSystemFont, "Microsoft YaHei", "Segoe UI", Roboto, sans-serif;
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.05);
    opacity: 0.9;
  }
}

.overlay-gif-container {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(10px);
}

.overlay-gif {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  border-radius: 10px;
  animation: scaleIn 0.5s ease-out;
}

@keyframes scaleIn {
  from {
    transform: scale(0.8);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .overlay-text {
    font-size: 36px;
  }
  
  .overlay-gif-container {
    width: 300px;
    height: 300px;
  }
}
```

## âœ… å¿«é€Ÿé›†æˆæ¸…å•

- [ ] å¤åˆ¶ `content.ts` åˆ°æ–°é¡¹ç›®
- [ ] å¤åˆ¶ `content.css` åˆ°æ–°é¡¹ç›®
- [ ] ä¿®æ”¹ç›®æ ‡ URL æ£€æµ‹é€»è¾‘
- [ ] ä¿®æ”¹æ­¥éª¤æ£€æµ‹é€‰æ‹©å™¨ï¼ˆæ ¹æ®ç›®æ ‡ç½‘ç«™è°ƒæ•´ï¼‰
- [ ] å‡†å¤‡ GIF åŠ¨ç”»æ–‡ä»¶
- [ ] æ›´æ–° Manifest é…ç½®
- [ ] é…ç½® `web_accessible_resources`
- [ ] æµ‹è¯•é®ç½©æ˜¾ç¤º/éšè—åŠŸèƒ½
- [ ] æµ‹è¯•ä¸åŒå±å¹•å°ºå¯¸
- [ ] æ·»åŠ é”™è¯¯å¤„ç†

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024-11-02  
**é€‚ç”¨ç‰ˆæœ¬**: Chrome Extension Manifest V3

